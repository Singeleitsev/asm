sub_bcd_r	macro	minuend,len_m,deduction,len_d,difference
local	temp,m1,m2,exit_m
;----------------------------------------------------------
;sub_bcd_r minuend,len_m,deduction,len_d,difference -
;макрокоманда вычитани€ неупакованных BCD-чисел размером 
;len_m и len_d байт и помещение результата в difference.
;¬ход: minuend и deduction - адреса младших байт 
;уменьшаемого и вычитаемого; len_m и len_d - длины 
;уменьшаемого и вычитаемого в байтах.
;¬ыход: difference - адрес младшего байта пол€ разности. 
;ƒлина пол€ difference должна быть не меньше длины 
;уменьшаемого.
;ѕор€док следовани€ байт - старший байт по младшему адресу 
;(не Intel).
;----------------------------------------------------------
	push	si
;копируем уменьшаемое в difference:
push	ds
pop	es
cld
	lea	si,minuend
	lea	di,difference
	mov	cx,len_m
	push	cx
rep	movsb
;копируем вычитаемое во врем. область temp:
	jmp	m1
temp	db	len_m dup (0)
m1:
std
	lea	si,deduction+len_m-1
	lea	di,cs:temp+len_m-1
	mov	cx,len_d
	push	cs
	pop	es
rep	movsb
mov	si,len_m-1
	pop	cx
m2:	mov	al,minuend[si]
	sbb	al,cs:temp[si]
	aas
	mov	difference[si],al
	dec	si
	loop	m2
	jc	m3	;на обработку заема из старшего разр€да
	jmp	exit_m
m3:	nop	;если нужно, то допишите фрагмент обработки заема из старшего разр€да
exit_m:
	pop	si
	endm
