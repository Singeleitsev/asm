;----------------------------------------------------------
;prg07_23.asm - программа демонстрации применения функции 7141h прерывания 21h для удаления файлов, имеющих длинные имена.
;----------------------------------------------------------
masm
model small
.data
handle	dw	0	;дескриптор файла
filename	db	'my_file with long name.txt',0
point_fname	dd	filename
fname_del	db	'my_file with long name.*',0
point_fname_del	dd	fname_del
.stack	256
.486
.code
main:
	mov	ax,@data	;адрес сегмента данных - в регистр ax
	mov	ds,ax	;ax в ds
;----------------------------------------------------------------------
	mov	bx,0100h+0400h	;не использовать буферизацию + содержимое DI в псевдоним
	mov	dx,1	;открыть файл, если он существует, иначе вернуть ошибку
	lds	si,point_fname	;формируем указатель на имя файла
	mov	di,7	;добавить в конец псевдонима символ 7
repeat:
	mov	ax,716ch	;номер функции DOS
	xor	cx,cx	;атрибуты файла - обычный файл - доступ для чтения-записи
	int	21h	;открываем файл
	jnc	m1	; если файл существовал, то переход
	mov	dx,10h	;создать файл
	jmp	repeat	;переход - повторим открытие файла
m1:
;-------------------------------------------------------------------
	mov	handle,ax	;сохраним дескриптор файла
;действия при успешном открытии файла:
;-------------------------------------------------------------------
;удалим файл:
	xor	cx,cx	;атрибуты файла
	mov	si,1	;будем использовать шаблон для поиска и последующего удаления
	lds	dx,point_fname_del	;формируем указатель на имя файла
	mov	ax,7141h
	int	21h
exit:
;выход из программы
	mov	ax,4c00h	;пересылка 4c00h в регистр ax
	int	21h	;вызов прерывания с номером 21h
end	main		;конец программы с точкой входа main
