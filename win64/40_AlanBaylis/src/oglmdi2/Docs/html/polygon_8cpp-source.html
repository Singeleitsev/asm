<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>polygon.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>polygon.cpp</h1><a href="polygon_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include &lt;windows.h&gt;</font>
00002 
00003 
00004 <font class="preprocessor">#include "<a class="code" href="polygon_8h.html">polygon.h</a>"</font>
00005 <font class="preprocessor">#include "<a class="code" href="general_8h.html">general.h</a>"</font>
00006 
<a name="l00007"></a><a class="code" href="classPOLYGON.html#a0">00007</a> <a class="code" href="classPOLYGON.html#a0">POLYGON::POLYGON</a>()
00008 {
00009 }
00010 
<a name="l00011"></a><a class="code" href="classPOLYGON.html#a1">00011</a> <a class="code" href="classPOLYGON.html#a1">POLYGON::~POLYGON</a>()
00012 {
00013 }
00014 
<a name="l00015"></a><a class="code" href="classPOLYGON.html#a2">00015</a> <a class="code" href="classVECTOR.html">VECTOR</a> <a class="code" href="classPOLYGON.html#a2">POLYGON::GetNormal</a>()
00016 {
00017         <a class="code" href="classVECTOR.html">VECTOR</a> temp; 
00018         <font class="keywordtype">float</font> ux;
00019         <font class="keywordtype">float</font> uy;
00020         <font class="keywordtype">float</font> uz;
00021         <font class="keywordtype">float</font> vx;
00022         <font class="keywordtype">float</font> vy;
00023         <font class="keywordtype">float</font> vz;
00024           ux = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m1">x</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a>;
00025           uy = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m2">y</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a>;
00026           uz = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m3">z</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a>;
00027           vx = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m1">x</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a>;
00028           vy = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m2">y</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a>;
00029           vz = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m3">z</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a>;
00030           temp.<a class="code" href="classVECTOR.html#m0">x</a> = (uy*vz)-(vy*uz);
00031           temp.<a class="code" href="classVECTOR.html#m1">y</a> = (uz*vx)-(vz*ux);
00032           temp.<a class="code" href="classVECTOR.html#m2">z</a> = (ux*vy)-(vx*uy);
00033         <font class="keywordflow">return</font> temp;
00034 }
00035 
<a name="l00036"></a><a class="code" href="classPOLYGON.html#a3">00036</a> <font class="keywordtype">void</font> <a class="code" href="classPOLYGON.html#a3">POLYGON::SetNormal</a>()
00037 {
00038         <font class="keywordtype">float</font> ux;
00039         <font class="keywordtype">float</font> uy;
00040         <font class="keywordtype">float</font> uz;
00041         <font class="keywordtype">float</font> vx;
00042         <font class="keywordtype">float</font> vy;
00043         <font class="keywordtype">float</font> vz;
00044           ux = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m1">x</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a>;
00045           uy = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m2">y</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a>;
00046           uz = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m3">z</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a>;
00047           vx = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m1">x</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a>;
00048           vy = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m2">y</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a>;
00049           vz = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m3">z</a> - <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a>;
00050           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m4">nx</a> = (uy*vz)-(vy*uz);
00051           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m5">ny</a> = (uz*vx)-(vz*ux);
00052           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m6">nz</a> = (ux*vy)-(vx*uy);
00053         <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m4">nx</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m4">nx</a>;
00054           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m5">ny</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m5">ny</a>;
00055           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m6">nz</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m6">nz</a>;
00056           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m4">nx</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m4">nx</a>;
00057           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m5">ny</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m5">ny</a>;
00058           <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m6">nz</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m6">nz</a>;
00059 }
00060 
<a name="l00061"></a><a class="code" href="classPOLYGON.html#a4">00061</a> <a class="code" href="classVECTOR.html">VECTOR</a> <a class="code" href="classPOLYGON.html#a4">POLYGON::GetMidPoint</a>()
00062 {
00063     <a class="code" href="classVECTOR.html">VECTOR</a> temp;
00064     temp.<a class="code" href="classVECTOR.html#m0">x</a> = (<a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m1">x</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m1">x</a>)/3;
00065     temp.<a class="code" href="classVECTOR.html#m1">y</a> = (<a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m2">y</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m2">y</a>)/3;
00066     temp.<a class="code" href="classVECTOR.html#m2">z</a> = (<a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m3">z</a> + <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m3">z</a>)/3;
00067     <font class="keywordflow">return</font> temp;
00068 }
00069 
<a name="l00070"></a><a class="code" href="classPOLYGON.html#a5">00070</a> <font class="keywordtype">bool</font> <a class="code" href="classPOLYGON.html#a5">POLYGON::CheckForCollision</a>(<a class="code" href="classCAMERA.html">CAMERA</a>* pLastCam, <a class="code" href="classCAMERA.html">CAMERA</a>* pCam)
00071 {
00072   <font class="keywordtype">float</font> Radius = 0.5;                            <font class="comment">//Collision sphere radius</font>
00073   <a class="code" href="classVECTOR.html">VECTOR</a> Vect1;                                    <font class="comment">//Change vertex representation of data to vectors</font>
00074   Vect1.<a class="code" href="classVECTOR.html#m0">x</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m1">x</a>;
00075   Vect1.<a class="code" href="classVECTOR.html#m1">y</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m2">y</a>;
00076   Vect1.<a class="code" href="classVECTOR.html#m2">z</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[0].<a class="code" href="classVERTEX.html#m3">z</a>;
00077   <a class="code" href="classVECTOR.html">VECTOR</a> Vect2;
00078   Vect2.<a class="code" href="classVECTOR.html#m0">x</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m1">x</a>;
00079   Vect2.<a class="code" href="classVECTOR.html#m1">y</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m2">y</a>;
00080   Vect2.<a class="code" href="classVECTOR.html#m2">z</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[1].<a class="code" href="classVERTEX.html#m3">z</a>;
00081   <a class="code" href="classVECTOR.html">VECTOR</a> Vect3;
00082   Vect3.<a class="code" href="classVECTOR.html#m0">x</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m1">x</a>;
00083   Vect3.<a class="code" href="classVECTOR.html#m1">y</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m2">y</a>;
00084   Vect3.<a class="code" href="classVECTOR.html#m2">z</a> = <a class="code" href="classPOLYGON.html#m1">Vertex</a>[2].<a class="code" href="classVERTEX.html#m3">z</a>;
00085   <font class="keywordtype">float</font> Flag = 0;                                <font class="comment">//Collision flag, 1 = collision occured</font>
00086   <font class="keywordtype">float</font> CamDistance;                                <font class="comment">//Camera distance from plane</font>
00087   <font class="keywordtype">float</font> LastCamDistance;                                <font class="comment">//LastCamera distance from plane</font>
00088   <a class="code" href="classVECTOR.html">VECTOR</a> CameraPos;                                <font class="comment">//Vector for the cameras position</font>
00089   <a class="code" href="classVECTOR.html">VECTOR</a> LastCameraPos;                                <font class="comment">//Vector for the cameras position</font>
00090   <a class="code" href="classVECTOR.html">VECTOR</a> TempVect;                                 <font class="comment">//Work variables</font>
00091   <font class="keywordtype">float</font> TempFloat;
00092   <a class="code" href="classVECTOR.html">VECTOR</a> Normal = <a class="code" href="classPOLYGON.html#a2">GetNormal</a>();                     <font class="comment">//Get this polygons face normal</font>
00093   Normal.<a class="code" href="classVECTOR.html#m0">x</a> = Normal.<a class="code" href="classVECTOR.html#m0">x</a> * -1;                        <font class="comment">//Invert normal. Not sure if this is a problem with my code or an ogl thing.</font>
00094   Normal.<a class="code" href="classVECTOR.html#m1">y</a> = Normal.<a class="code" href="classVECTOR.html#m1">y</a> * -1;
00095   Normal.<a class="code" href="classVECTOR.html#m2">z</a> = Normal.<a class="code" href="classVECTOR.html#m2">z</a> * -1;
00096   Normal = <a class="code" href="locmath_8cpp.html#a14">GetUnitVector</a>(Normal);                  <font class="comment">//Convert to a unit vector</font>
00097   TempFloat = -1 * <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(Normal, Vect1);      <font class="comment">// Take the dot product of the face normal and any point on the face, and negate that. This will be your d (distance offset) component of the plane equation.</font>
00098   CameraPos.<a class="code" href="classVECTOR.html#m0">x</a> = -1 * pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m0">x</a>;             <font class="comment">//Get inverted current camera position</font>
00099   CameraPos.<a class="code" href="classVECTOR.html#m1">y</a> = -1 * pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m1">y</a>;
00100   CameraPos.<a class="code" href="classVECTOR.html#m2">z</a> = -1 * pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m2">z</a>;
00101   CamDistance = <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(Normal, CameraPos) - TempFloat;  <font class="comment">//Distance from polygons plane</font>
00102   LastCameraPos.<a class="code" href="classVECTOR.html#m0">x</a> = -1 * pLastCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m0">x</a>;             <font class="comment">//Get inverted last camera position</font>
00103   LastCameraPos.<a class="code" href="classVECTOR.html#m1">y</a> = -1 * pLastCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m1">y</a>;
00104   LastCameraPos.<a class="code" href="classVECTOR.html#m2">z</a> = -1 * pLastCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m2">z</a>;
00105   LastCamDistance = <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(Normal, LastCameraPos) - TempFloat;  <font class="comment">//Distance from polygons plane</font>
00106   <font class="keywordflow">if</font>(!(CamDistance &lt; Radius &amp;&amp; LastCamDistance &gt;= Radius))             <font class="comment">//If CamDistance &lt; Radius and LastCamDistance &gt;= Radius then it passed through the polygon</font>
00107     <font class="keywordflow">goto</font> Skip;                                     <font class="comment">//If not, end the collision test</font>
00108   TempVect = <a class="code" href="locmath_8cpp.html#a15">GetEdgeVector</a>(Vect1, Vect2);          <font class="comment">//Create edge vector</font>
00109   TempVect = <a class="code" href="locmath_8cpp.html#a6">CrossVector</a>(Normal, TempVect);       <font class="comment">//Cross product of edge vector and polygons normal gives us the anti-planes normal</font>
00110   TempVect = <a class="code" href="locmath_8cpp.html#a14">GetUnitVector</a>(TempVect);              <font class="comment">//Reduce anti-plane normal to a unit vector</font>
00111   TempFloat = -1 * <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, Vect1);    <font class="comment">//Distance offset to plane equation</font>
00112   TempFloat = <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, CameraPos) - TempFloat; <font class="comment">//Find distance to the plane</font>
00113   <font class="keywordflow">if</font>(TempFloat &gt;= Radius)<font class="comment">// - 0.2)                    //Reducing the radius here makes sure the sphere is well on the polygon before colliding</font>
00114     <font class="keywordflow">goto</font> Skip;
00115   TempVect = <a class="code" href="locmath_8cpp.html#a15">GetEdgeVector</a>(Vect2, Vect3);
00116   TempVect = <a class="code" href="locmath_8cpp.html#a6">CrossVector</a>(Normal, TempVect);
00117   TempVect = <a class="code" href="locmath_8cpp.html#a14">GetUnitVector</a>(TempVect);
00118   TempFloat = -1 * <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, Vect2);
00119   TempFloat = <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, CameraPos) - TempFloat;
00120   <font class="keywordflow">if</font>(TempFloat &gt;= Radius)<font class="comment">// - 0.2)</font>
00121     <font class="keywordflow">goto</font> Skip;
00122   TempVect = <a class="code" href="locmath_8cpp.html#a15">GetEdgeVector</a>(Vect3, Vect1);
00123   TempVect = <a class="code" href="locmath_8cpp.html#a6">CrossVector</a>(Normal, TempVect);
00124   TempVect = <a class="code" href="locmath_8cpp.html#a14">GetUnitVector</a>(TempVect);
00125   TempFloat = -1 * <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, Vect3);
00126   TempFloat = <a class="code" href="locmath_8cpp.html#a5">DotProduct</a>(TempVect, CameraPos) - TempFloat;
00127   <font class="keywordflow">if</font>(TempFloat &gt;= Radius)<font class="comment">// - 0.2)</font>
00128     <font class="keywordflow">goto</font> Skip;
00129   TempFloat = (Radius - CamDistance)/<a class="code" href="locmath_8cpp.html#a13">MagnitudeVector</a>(Normal);  <font class="comment">//Calculate new position and distance of slide</font>
00130   pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m0">x</a> -= (TempFloat * Normal.<a class="code" href="classVECTOR.html#m0">x</a>);               <font class="comment">//Update the camera position</font>
00131   pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m1">y</a> -= (TempFloat * Normal.<a class="code" href="classVECTOR.html#m1">y</a>);
00132   pCam-&gt;<a class="code" href="classOBJECT.html#m1">Position</a>.<a class="code" href="classVECTOR.html#m2">z</a> -= (TempFloat * Normal.<a class="code" href="classVECTOR.html#m2">z</a>);
00133   Flag = 1;                                    <font class="comment">//Set collision flag to true</font>
00134   <font class="keywordflow">return</font> Flag;
00135 Skip:
00136   <font class="keywordflow">return</font> Flag;
00137 }
00138 
00139 
00140 
</pre></div><hr><address align="right"><small>Generated on Fri Dec 23 05:19:34 2005 for OpenGL MDI 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
