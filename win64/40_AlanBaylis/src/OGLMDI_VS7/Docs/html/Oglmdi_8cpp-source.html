<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oglmdi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oglmdi.cpp</h1><a href="Oglmdi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">                                   OpenGL MDI Example</font>
00003 <font class="comment"></font>
00004 <font class="comment">                                 Program by Alan Baylis </font>
00005 <font class="comment">                                  Copyright 24/01/2001</font>
00006 <font class="comment"></font>
00007 <font class="comment"></font>
00008 <font class="comment">This program demonstrates a Win32 MDI application with OpenGL compatible child windows.</font>
00009 <font class="comment"></font>
00010 <font class="comment">This code may be freely modified and redistributed but I make no warrantees about it; use at your own risk. If you use this code then give me credit and a link back to this site.</font>
00011 <font class="comment">An email or a post to my message board of where we could find your program would be nice too.</font>
00012 <font class="comment"></font>
00013 <font class="comment">*/</font>
00014 
00015 <font class="preprocessor">#include &lt;windows.h&gt;</font>
00016 <font class="preprocessor">#include &lt;gl\gl.h&gt;</font>
00017 <font class="preprocessor">#include &lt;gl\glu.h&gt;</font>
00018 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00019 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>                            <font class="comment">// Header for Visual Component Library required for USERC(...);</font>
00020 <font class="preprocessor">#include "resource.rh"</font>                            <font class="comment">// Header for resource file</font>
00021 
<a name="l00022"></a><a class="code" href="Oglmdi_8cpp.html#a0">00022</a> <font class="preprocessor">#define ID_MDI_CLIENT      4999             // ID for client menu</font>
<a name="l00023"></a><a class="code" href="Oglmdi_8cpp.html#a1">00023</a> <font class="preprocessor"></font><font class="preprocessor">#define ID_MDI_FIRSTCHILD  50000            // Start ID for child windows</font>
00024 <font class="preprocessor"></font>
<a name="l00025"></a><a class="code" href="Oglmdi_8cpp.html#a2">00025</a> <font class="keywordtype">char</font> <a class="code" href="Oglmdi_8cpp.html#a2">g_szMainClassName</a>[] = <font class="stringliteral">"MainWindow"</font>;
<a name="l00026"></a><a class="code" href="Oglmdi_8cpp.html#a3">00026</a> <font class="keywordtype">char</font> <a class="code" href="Oglmdi_8cpp.html#a3">g_szChildClassName</a>[] = <font class="stringliteral">"OpenGL"</font>;
<a name="l00027"></a><a class="code" href="Oglmdi_8cpp.html#a4">00027</a> HINSTANCE <a class="code" href="Oglmdi_8cpp.html#a4">g_hInst</a>;
<a name="l00028"></a><a class="code" href="Oglmdi_8cpp.html#a5">00028</a> HWND <a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>;
<a name="l00029"></a><a class="code" href="Oglmdi_8cpp.html#a6">00029</a> HWND <a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a>;
<a name="l00030"></a><a class="code" href="Oglmdi_8cpp.html#a7">00030</a> RECT <a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>;                         <font class="comment">// RECT structure required to get the child window dimensions</font>
00031 
<a name="l00032"></a><a class="code" href="Oglmdi_8cpp.html#a9">00032</a> <font class="keywordtype">float</font>    <a class="code" href="Oglmdi_8cpp.html#a8">g_fCubeRotationX</a>, <a class="code" href="Oglmdi_8cpp.html#a9">g_fCubeRotationY</a>;      
00033 
<a name="l00034"></a><a class="code" href="Oglmdi_8cpp.html#a10">00034</a> <font class="keywordtype">bool</font> <a class="code" href="Oglmdi_8cpp.html#a10">g_bMouseDrag</a> = 0;                         <font class="comment">// Mouse capture flag</font>
<a name="l00035"></a><a class="code" href="Oglmdi_8cpp.html#a11">00035</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a11">g_iMouseLastX</a>;                             <font class="comment">// Holds previous X position of mouse</font>
<a name="l00036"></a><a class="code" href="Oglmdi_8cpp.html#a12">00036</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a12">g_iMouseLastY</a>;                             <font class="comment">// Holds previous Y position of mouse</font>
<a name="l00037"></a><a class="code" href="Oglmdi_8cpp.html#a13">00037</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a13">g_iMouseDeltaX</a>;                            <font class="comment">// Holds the mouse increment in X since LastX</font>
<a name="l00038"></a><a class="code" href="Oglmdi_8cpp.html#a14">00038</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a14">g_iMouseDeltaY</a>;                            <font class="comment">// Holds the mouse increment in Y since LastY</font>
00039 
<a name="l00040"></a><a class="code" href="structCHILD.html">00040</a> <font class="keyword">typedef</font> <font class="keyword">struct </font><a class="code" href="structCHILD.html">CHILD</a>                        <font class="comment">// Child structure for each child window</font>
00041 {
<a name="l00042"></a><a class="code" href="structCHILD.html#m0">00042</a>     HDC <a class="code" href="structCHILD.html#m0">hDC</a>;                                <font class="comment">// Individual device context</font>
<a name="l00043"></a><a class="code" href="structCHILD.html#m1">00043</a>     HGLRC <a class="code" href="structCHILD.html#m1">hRC</a>;                              <font class="comment">// Individual rendering context</font>
<a name="l00044"></a><a class="code" href="structCHILD.html#m2">00044</a>     HWND <a class="code" href="structCHILD.html#m2">hWnd</a>;                              <font class="comment">// Handle to child window</font>
00045 } <a class="code" href="structCHILD.html">CHILD</a>;
00046 
<a name="l00047"></a><a class="code" href="Oglmdi_8cpp.html#a16">00047</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a16">g_iMaxChild</a> = 50;                          <font class="comment">// Maximum number of child windows wanted</font>
<a name="l00048"></a><a class="code" href="Oglmdi_8cpp.html#a17">00048</a> <font class="keywordtype">int</font> <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> = 0;                           <font class="comment">// Number of child windows created</font>
<a name="l00049"></a><a class="code" href="Oglmdi_8cpp.html#a18">00049</a> <a class="code" href="structCHILD.html">CHILD</a>* <a class="code" href="Oglmdi_8cpp.html#a18">g_child</a> = <font class="keyword">new</font> <a class="code" href="structCHILD.html">CHILD</a>[<a class="code" href="Oglmdi_8cpp.html#a16">g_iMaxChild</a>];         <font class="comment">// Create the CHILD structures</font>
00050 
00051 <font class="comment">/* Set the rendering options for OpenGL */</font>
<a name="l00052"></a><a class="code" href="Oglmdi_8cpp.html#a19">00052</a> <font class="keywordtype">void</font> <a class="code" href="Oglmdi_8cpp.html#a19">InitGL</a>()
00053 {
00054     glCullFace(GL_BACK);
00055     glClearColor(0.0, 0.0, 0.0, 0.0);
00056     glClearDepth(1.0);
00057     glDepthFunc(GL_LESS);
00058     glEnable(GL_DEPTH_TEST);
00059     glShadeModel(GL_SMOOTH);
00060     glEnable(GL_NORMALIZE);
00061 
00062     <font class="keywordtype">float</font> MatAmbient[] = {0.8, 0.8, 0.8, 1.0};
00063     <font class="keywordtype">float</font> MatDiffuse[] = {0.8, 0.8, 0.8, 1.0};
00064     <font class="keywordtype">float</font> MatSpecular[] = {0.9, 0.9, 0.9, 1.0};
00065     <font class="keywordtype">float</font> MatEmmision[] = {0.0, 0.0, 0.0, 1.0};
00066     <font class="keywordtype">float</font> MatShininess[] = {100.0};
00067 
00068     glMaterialfv(GL_FRONT, GL_AMBIENT, MatAmbient);
00069     glMaterialfv(GL_FRONT, GL_DIFFUSE, MatDiffuse);
00070     glMaterialfv(GL_FRONT, GL_SPECULAR, MatSpecular);
00071     glMaterialfv(GL_FRONT, GL_EMISSION, MatEmmision);
00072     glMaterialfv(GL_FRONT, GL_SHININESS, MatShininess);
00073 
00074     <font class="keywordtype">float</font> LightAmbient[] = {0.2, 0.2, 0.2, 1.0};
00075     glLightfv(GL_LIGHT0, GL_AMBIENT, LightAmbient);
00076     <font class="keywordtype">float</font> LightPosition[] = {-3.0, 2.0, 1.0, 1.0};
00077     glLightfv(GL_LIGHT0, GL_POSITION, LightPosition);
00078 
00079     glEnable(GL_LIGHTING);
00080     glEnable(GL_LIGHT0);
00081     glEnable(GL_CULL_FACE);
00082 }
00083 
00084 <font class="comment">/* Sets the Projection matrix. The Modelview matrix is set in the DrawGLScene routine */</font>
<a name="l00085"></a><a class="code" href="Oglmdi_8cpp.html#a20">00085</a> <font class="keywordtype">void</font> <a class="code" href="Oglmdi_8cpp.html#a20">SetProjection</a>(<font class="keywordtype">int</font> iWidth, <font class="keywordtype">int</font> iHeight)
00086 {
00087     <font class="keywordflow">if</font>(iHeight == 0)
00088     {
00089         iHeight = 1;
00090     }
00091     glViewport(0, 0, iWidth, iHeight);
00092     glMatrixMode(GL_PROJECTION);
00093     glLoadIdentity();
00094     gluPerspective(45.0,(<font class="keywordtype">float</font>)iWidth/(<font class="keywordtype">float</font>)iHeight,0.1,200.0);
00095 }
00096 
<a name="l00097"></a><a class="code" href="Oglmdi_8cpp.html#a21">00097</a> <font class="keywordtype">void</font> <a class="code" href="Oglmdi_8cpp.html#a21">DrawGLScene</a>(<font class="keywordtype">void</font>)
00098 {
00099     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
00100     glMatrixMode(GL_MODELVIEW);
00101     glLoadIdentity();
00102 
00103     <font class="keywordflow">if</font>(g_bMouseDrag)        <font class="comment">// If left mouse button is down</font>
00104     {
00105         <a class="code" href="Oglmdi_8cpp.html#a8">g_fCubeRotationX</a> += (float)<a class="code" href="Oglmdi_8cpp.html#a14">g_iMouseDeltaY</a> * 0.5;   <font class="comment">// Apply mouse deltas to cube rotation values</font>
00106         <a class="code" href="Oglmdi_8cpp.html#a9">g_fCubeRotationY</a> += (float)<a class="code" href="Oglmdi_8cpp.html#a13">g_iMouseDeltaX</a> * 0.5;
00107     }
00108 
00109     glDisable(GL_TEXTURE_2D);
00110     glDisable(GL_LIGHTING);
00111     glPushMatrix();
00112     glTranslatef(0.0,0.0,-5.0);
00113     glRotatef(<a class="code" href="Oglmdi_8cpp.html#a8">g_fCubeRotationX</a>,1.0,0.0,0.0);
00114     glRotatef(<a class="code" href="Oglmdi_8cpp.html#a9">g_fCubeRotationY</a>,0.0,1.0,0.0);
00115     glBegin(GL_QUADS);
00116         <font class="comment">// Front Face</font>
00117         glColor3f(1.0,0.0,0.0);
00118         glVertex3f(-1.0, -1.0,  1.0);    <font class="comment">// Bottom Left</font>
00119         glColor3f(0.0,1.0,0.0);
00120         glVertex3f( 1.0, -1.0,  1.0);    <font class="comment">// Bottom Right</font>
00121         glColor3f(0.0,0.0,1.0);
00122         glVertex3f( 1.0,  1.0,  1.0);    <font class="comment">// Top Right</font>
00123         glColor3f(1.0,1.0,0.0);
00124         glVertex3f(-1.0,  1.0,  1.0);    <font class="comment">// Top Left</font>
00125         <font class="comment">// Back Face</font>
00126         glColor3f(0.0,0.0,1.0);
00127         glVertex3f(-1.0, -1.0, -1.0);    <font class="comment">// Bottom Right</font>
00128         glColor3f(0.0,1.0,0.0);
00129         glVertex3f(-1.0,  1.0, -1.0);    <font class="comment">// Top Right</font>
00130         glColor3f(1.0,0.0,0.0);
00131         glVertex3f( 1.0,  1.0, -1.0);    <font class="comment">// Top Left</font>
00132         glColor3f(1.0,1.0,0.0);
00133         glVertex3f( 1.0, -1.0, -1.0);    <font class="comment">// Bottom Left</font>
00134         <font class="comment">// Top Face</font>
00135         glColor3f(0.0,1.0,0.0);
00136         glVertex3f(-1.0,  1.0, -1.0);    <font class="comment">// Top Left</font>
00137         glColor3f(1.0,1.0,0.0);
00138         glVertex3f(-1.0,  1.0,  1.0);    <font class="comment">// Bottom Left</font>
00139         glColor3f(0.0,0.0,1.0);
00140         glVertex3f( 1.0,  1.0,  1.0);    <font class="comment">// Bottom Right</font>
00141         glColor3f(1.0,0.0,0.0);
00142         glVertex3f( 1.0,  1.0, -1.0);    <font class="comment">// Top Right</font>
00143         <font class="comment">// Bottom Face</font>
00144         glColor3f(0.0,0.0,1.0);
00145         glVertex3f(-1.0, -1.0, -1.0);    <font class="comment">// Top Right</font>
00146         glColor3f(1.0,1.0,0.0);
00147         glVertex3f( 1.0, -1.0, -1.0);    <font class="comment">// Top Left</font>
00148         glColor3f(0.0,1.0,0.0);
00149         glVertex3f( 1.0, -1.0,  1.0);    <font class="comment">// Bottom Left</font>
00150         glColor3f(1.0,0.0,0.0);
00151         glVertex3f(-1.0, -1.0,  1.0);    <font class="comment">// Bottom Right</font>
00152         <font class="comment">// Right face</font>
00153         glColor3f(1.0,1.0,0.0);
00154         glVertex3f( 1.0, -1.0, -1.0);    <font class="comment">// Bottom Right</font>
00155         glColor3f(1.0,0.0,0.0);
00156         glVertex3f( 1.0,  1.0, -1.0);    <font class="comment">// Top Right</font>
00157         glColor3f(0.0,0.0,1.0);
00158         glVertex3f( 1.0,  1.0,  1.0);    <font class="comment">// Top Left</font>
00159         glColor3f(0.0,1.0,0.0);
00160         glVertex3f( 1.0, -1.0,  1.0);    <font class="comment">// Bottom Left</font>
00161         <font class="comment">// Left Face</font>
00162         glColor3f(0.0,0.0,1.0);
00163         glVertex3f(-1.0, -1.0, -1.0);    <font class="comment">// Bottom Left</font>
00164         glColor3f(1.0,0.0,0.0);
00165         glVertex3f(-1.0, -1.0,  1.0);    <font class="comment">// Bottom Right</font>
00166         glColor3f(1.0,1.0,0.0);
00167         glVertex3f(-1.0,  1.0,  1.0);    <font class="comment">// Top Right</font>
00168         glColor3f(0.0,1.0,0.0);
00169         glVertex3f(-1.0,  1.0, -1.0);    <font class="comment">// Top Left</font>
00170     glEnd();
00171     glPopMatrix();
00172     glEnable(GL_LIGHTING);
00173     glEnable(GL_TEXTURE_2D);
00174 }
00175 
<a name="l00176"></a><a class="code" href="Oglmdi_8cpp.html#a22">00176</a> LRESULT CALLBACK <a class="code" href="Oglmdi_8cpp.html#a22">WndProc</a>(HWND hWnd, UINT uMessage, WPARAM wParam, LPARAM lParam)
00177 {
00178     <font class="keywordflow">switch</font>(uMessage)
00179     {
00180         <font class="keywordflow">case</font> WM_CREATE:
00181         {
00182             CLIENTCREATESTRUCT ccs;
00183             <font class="comment">// Find window menu where children will be listed</font>
00184             ccs.hWindowMenu = NULL;
00185 <font class="comment">// If the menus document list for more than 9 children didn't upset the child ID then I would use the line below</font>
00186             <font class="comment">//ccs.hWindowMenu = (HMENU)GetSubMenu(GetMenu(hWnd), 2); // if you use less than 10 windows then use this line</font>
00187             ccs.idFirstChild = <a class="code" href="Oglmdi_8cpp.html#a1">ID_MDI_FIRSTCHILD</a>;
00188 
00189             <a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a> = CreateWindowEx(WS_EX_CLIENTEDGE, <font class="stringliteral">"MDICLIENT"</font>, NULL,
00190             WS_CHILD | WS_CLIPCHILDREN | WS_CLIPSIBLINGS,                    <font class="comment">//WS_VSCROLL and WS_HSCROLL do not work properly yet</font>
00191             CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,
00192             hWnd, (HMENU)<a class="code" href="Oglmdi_8cpp.html#a0">ID_MDI_CLIENT</a>, <a class="code" href="Oglmdi_8cpp.html#a4">g_hInst</a>, (LPVOID)&amp;ccs);
00193 
00194             ShowWindow(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, SW_SHOW);
00195             <font class="keywordflow">return</font> 0;
00196         }
00197         <font class="keywordflow">case</font> WM_COMMAND:
00198         {
00199             <font class="keywordflow">switch</font>(LOWORD(wParam))
00200             {
00201                 <font class="keywordflow">case</font> CM_FILE_EXIT:
00202                     PostMessage(hWnd, WM_CLOSE, 0, 0);
00203                 <font class="keywordflow">break</font>;
00204 
00205                 <font class="keywordflow">case</font> CM_FILE_NEW:
00206                 {
00207                     HWND hChild;
00208 
00209                     <font class="keywordflow">if</font>(<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> &lt; <a class="code" href="Oglmdi_8cpp.html#a16">g_iMaxChild</a>)      <font class="comment">// If the number of children hasn't reached the maximum</font>
00210                         <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a>++;              <font class="comment">// Increment the number of children</font>
00211                     <font class="keywordflow">else</font>
00212                         <font class="keywordflow">break</font>;                   <font class="comment">// Otherwise break out of the routine</font>
00213 
00214                     <font class="keywordtype">char</font> szWindowTitle[20];
00215                     sprintf(szWindowTitle, <font class="stringliteral">"%d"</font>, <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1);
00216 
00217 <font class="comment">/* One way to create a child window is to send a WM_MDICREATE message to the client</font>
00218 <font class="comment">window and pass it a pointer to a MDICREATESTRUCT. */</font>
00219 
00220 <font class="comment">/*</font>
00221 <font class="comment">                    MDICREATESTRUCT mcs;</font>
00222 <font class="comment">                    mcs.szTitle = szWindowTitle;</font>
00223 <font class="comment">                    mcs.szClass = g_szChildClassName;</font>
00224 <font class="comment">                    mcs.hOwner  = g_hInst;</font>
00225 <font class="comment">                    mcs.x = mcs.cx = CW_USEDEFAULT;</font>
00226 <font class="comment">                    mcs.y = mcs.cy = CW_USEDEFAULT;</font>
00227 <font class="comment">                    mcs.style = MDIS_ALLCHILDSTYLES;</font>
00228 <font class="comment"></font>
00229 <font class="comment">                    hChild = (HWND)SenduMessage(g_hMDIClient, WM_MDICREATE, 0, (LONG)&amp;mcs);</font>
00230 <font class="comment">//*/</font>
00231 
00232 <font class="comment">/* Another way to create a child window is to use CreateWindowEx and set the extended</font>
00233 <font class="comment">windows style  to WS_EX_MDICHILD. I prefer this method as it will allow each child to be created in</font>
00234 <font class="comment">seperate threads in the future. */</font>
00235 
00236 <font class="comment">//*</font>
00237                     CREATESTRUCT cs;
00238                     ZeroMemory(&amp;cs, <font class="keyword">sizeof</font>(CREATESTRUCT));
00239 
00240                     hChild = CreateWindowEx(
00241                     WS_EX_MDICHILD,
00242                     <a class="code" href="Oglmdi_8cpp.html#a3">g_szChildClassName</a>,
00243                     szWindowTitle,
00244                     WS_CHILD | WS_VISIBLE | WS_OVERLAPPEDWINDOW,
00245                     CW_USEDEFAULT,
00246                     CW_USEDEFAULT,
00247                     CW_USEDEFAULT,
00248                     CW_USEDEFAULT,
00249                     <a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>,
00250                     NULL,
00251                     <a class="code" href="Oglmdi_8cpp.html#a4">g_hInst</a>,
00252                     &amp;cs
00253                     );
00254 <font class="comment">//*/</font>
00255                     <font class="keywordflow">if</font>(!hChild)
00256                     {
00257                         MessageBox(NULL, <font class="stringliteral">"Child creation failed."</font>, <font class="stringliteral">"Error"</font>,
00258                         MB_ICONEXCLAMATION | MB_OK);
00259                     }
00260 
00261                     g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hWnd = hChild;         <font class="comment">// Set child windows handle</font>
00262                     g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hDC = GetDC(hChild);   <font class="comment">// Set child windows device context</font>
00263 
00264                     PIXELFORMATDESCRIPTOR pfd;
00265                     ZeroMemory(&amp;pfd, <font class="keyword">sizeof</font>(pfd));
00266                     pfd.nSize = <font class="keyword">sizeof</font>(pfd);
00267                     pfd.nVersion = 1;
00268                     pfd.dwFlags = PFD_DRAW_TO_WINDOW | PFD_SUPPORT_OPENGL | PFD_DOUBLEBUFFER;
00269                     pfd.iPixelType = PFD_TYPE_RGBA;
00270                     pfd.cColorBits = 24;
00271                     pfd.cDepthBits = 16;
00272                     pfd.iLayerType = PFD_MAIN_PLANE;
00273                     <font class="keywordtype">int</font> iFormat = ChoosePixelFormat(g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hDC, &amp;pfd);
00274                     SetPixelFormat(g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hDC, iFormat, &amp;pfd);               <font class="comment">// Set pixel format for this child</font>
00275 
00276                     g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hRC = wglCreateContext(g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hDC);  <font class="comment">// Set childs rendering context</font>
00277                     wglMakeCurrent(g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hDC, g_child[<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> - 1].hRC);     <font class="comment">// Make this child the current DC and RC</font>
00278                     <a class="code" href="Oglmdi_8cpp.html#a19">InitGL</a>();                                                             <font class="comment">// Initialize the rendering defaults for this child</font>
00279                 }
00280                 <font class="keywordflow">break</font>;
00281 
00282                 <font class="keywordflow">case</font> CM_WINDOW_TILEHORZ:
00283                     PostMessage(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, WM_MDITILE, MDITILE_HORIZONTAL, 0);
00284                 <font class="keywordflow">break</font>;
00285 
00286                 <font class="keywordflow">case</font> CM_WINDOW_TILEVERT:
00287                     PostMessage(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, WM_MDITILE, MDITILE_VERTICAL, 0);
00288                 <font class="keywordflow">break</font>;
00289 
00290                 <font class="keywordflow">case</font> CM_WINDOW_CASCADE:
00291                     PostMessage(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, WM_MDICASCADE, 0, 0);
00292                 <font class="keywordflow">break</font>;
00293 
00294                 <font class="keywordflow">case</font> CM_WINDOW_ARRANGE:
00295                     PostMessage(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, WM_MDIICONARRANGE, 0, 0);
00296                 <font class="keywordflow">break</font>;
00297 
00298                 <font class="keywordflow">default</font>:
00299                 {
00300                     <font class="keywordflow">if</font>(LOWORD(wParam) &gt;= <a class="code" href="Oglmdi_8cpp.html#a1">ID_MDI_FIRSTCHILD</a>)
00301                     {
00302                         DefFrameProc(hWnd, <a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, uMessage, wParam, lParam);
00303                     }
00304                     <font class="keywordflow">else</font>
00305                     {
00306                         HWND hChild;
00307                         hChild = (HWND)SendMessage(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, WM_MDIGETACTIVE, 0, 0);
00308                         <font class="keywordflow">if</font>(hChild)
00309                         {
00310                             SendMessage(hChild, WM_COMMAND, wParam, lParam);
00311                         }
00312                     }
00313                 }
00314             }
00315         }
00316         <font class="keywordflow">break</font>;
00317 
00318         <font class="keywordflow">case</font> WM_CLOSE:
00319         {
00320             <font class="keywordtype">int</font> iLoop;
00321             <font class="keywordflow">if</font>(g_iNumChild)             <font class="comment">// If there are any children</font>
00322             {
00323                 <font class="keywordflow">for</font>(iLoop = 0; iLoop &lt; <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a>; iLoop++)     <font class="comment">// Send all children the WM_CLOSE to free up their DC and RC</font>
00324                 {
00325                     SendMessage(g_child[iLoop].hWnd, WM_CLOSE, 0, 0);
00326                 }
00327             }
00328             <font class="keyword">delete</font>[] g_child;             <font class="comment">// Delete the array of children</font>
00329             DestroyWindow(hWnd);
00330         }
00331         <font class="keywordflow">break</font>;
00332 
00333         <font class="keywordflow">case</font> WM_DESTROY:
00334             PostQuitMessage(0);
00335         <font class="keywordflow">break</font>;
00336 
00337         <font class="keywordflow">default</font>:
00338             <font class="keywordflow">return</font> DefFrameProc(hWnd, <a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, uMessage, wParam, lParam);
00339     }
00340     <font class="keywordflow">return</font> 0;
00341 }
00342 
<a name="l00343"></a><a class="code" href="Oglmdi_8cpp.html#a23">00343</a> LRESULT CALLBACK <a class="code" href="Oglmdi_8cpp.html#a23">MDIChildWndProc</a>(HWND hWnd, UINT uMessage, WPARAM wParam, LPARAM lParam)
00344 {
00345     <font class="keywordflow">switch</font>(uMessage)
00346     {
00347         <font class="keywordflow">case</font> WM_LBUTTONDOWN:
00348             <a class="code" href="Oglmdi_8cpp.html#a10">g_bMouseDrag</a> = 1;                <font class="comment">// Set mouse flag</font>
00349             <a class="code" href="Oglmdi_8cpp.html#a11">g_iMouseLastX</a> = LOWORD(lParam);  <font class="comment">// Get mouse position</font>
00350             <a class="code" href="Oglmdi_8cpp.html#a12">g_iMouseLastY</a> = HIWORD(lParam);
00351             SetCapture(hWnd);             <font class="comment">// Capture the mouse</font>
00352         <font class="keywordflow">break</font>;
00353 
00354         <font class="keywordflow">case</font> WM_MOUSEMOVE:
00355             <font class="keywordflow">if</font>(g_bMouseDrag)                  <font class="comment">// If mouse flag set</font>
00356             {
00357                 <a class="code" href="Oglmdi_8cpp.html#a13">g_iMouseDeltaX</a> = LOWORD(lParam) - <a class="code" href="Oglmdi_8cpp.html#a11">g_iMouseLastX</a>;   <font class="comment">// Get mouse deltas</font>
00358                 <a class="code" href="Oglmdi_8cpp.html#a14">g_iMouseDeltaY</a> = HIWORD(lParam) - <a class="code" href="Oglmdi_8cpp.html#a12">g_iMouseLastY</a>;
00359                 <a class="code" href="Oglmdi_8cpp.html#a11">g_iMouseLastX</a> = LOWORD(lParam);                 <font class="comment">// Get new mouse position</font>
00360                 <a class="code" href="Oglmdi_8cpp.html#a12">g_iMouseLastY</a> = HIWORD(lParam);
00361             }
00362         <font class="keywordflow">break</font>;
00363 
00364         <font class="keywordflow">case</font> WM_LBUTTONUP:         <font class="comment">// If left button is released</font>
00365             <a class="code" href="Oglmdi_8cpp.html#a10">g_bMouseDrag</a> = 0;         <font class="comment">// Clear mouse flag</font>
00366             ReleaseCapture();      <font class="comment">// Release the mouse capture</font>
00367         <font class="keywordflow">break</font>;
00368 
00369 <font class="comment">/*</font>
00370 <font class="comment">        //This msg isn't posted if the mouse is captured</font>
00371 <font class="comment">        case WM_NCMOUSEMOVE:</font>
00372 <font class="comment">        {</font>
00373 <font class="comment">            POINTS pts;</font>
00374 <font class="comment">            if(g_bMouseDrag)</font>
00375 <font class="comment">            {</font>
00376 <font class="comment">                pts = MAKEPOINTS(lParam);</font>
00377 <font class="comment">                g_iMouseDeltaX = pts.x - g_iMouseLastX;</font>
00378 <font class="comment">                g_iMouseDeltaY = pts.y - g_iMouseLastY;</font>
00379 <font class="comment">                g_iMouseLastX = pts.x;</font>
00380 <font class="comment">                g_iMouseLastY = pts.y;</font>
00381 <font class="comment">            }</font>
00382 <font class="comment">        }</font>
00383 <font class="comment">        break;</font>
00384 <font class="comment">//*/</font>
00385 
00386 <font class="comment">/* The following code paints the child window when necessary but isn't needed as we</font>
00387 <font class="comment">repaint all of them each frame. */</font>
00388 
00389 <font class="comment">/*</font>
00390 <font class="comment">        case WM_PAINT:</font>
00391 <font class="comment">        {</font>
00392 <font class="comment">            int iThisChild;</font>
00393 <font class="comment">            PAINTSTRUCT ps;</font>
00394 <font class="comment">            BeginPaint(hWnd, &amp;ps);</font>
00395 <font class="comment">            iThisChild = GetDlgCtrlID(hWnd) - ID_MDI_FIRSTCHILD;</font>
00396 <font class="comment">            wglMakeCurrent(g_child[iThisChild].hDC, g_child[iThisChild].hRC);</font>
00397 <font class="comment">            GetClientRect(hWnd, &amp;g_rectChild);</font>
00398 <font class="comment">            if(g_rectChild.right &gt; 0 &amp;&amp; g_rectChild.bottom &gt; 0)</font>
00399 <font class="comment">                SetProjection(g_rectChild.right, g_rectChild.bottom);</font>
00400 <font class="comment">            DrawGLScene();</font>
00401 <font class="comment">            glFlush();</font>
00402 <font class="comment">            SwapBuffers(hDC);</font>
00403 <font class="comment">            EndPaint(hWnd, &amp;ps);</font>
00404 <font class="comment">        }</font>
00405 <font class="comment">        break;</font>
00406 <font class="comment">//*/</font>
00407         <font class="keywordflow">case</font> WM_CLOSE:
00408             <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a>--;                       <font class="comment">// Decrement the number of child windows</font>
00409             <font class="keywordflow">if</font>(<a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a> == 0)                 <font class="comment">// If this is the last child window then just free the DC and RC</font>
00410             {
00411                 wglMakeCurrent( NULL, NULL );
00412                 ReleaseDC(g_child[0].hWnd, g_child[0].hDC);
00413                 wglDeleteContext(g_child[0].hRC);
00414             }
00415             <font class="keywordflow">else</font>
00416             {
00417                 <font class="keywordtype">int</font> iLoop;
00418                 <font class="keywordtype">int</font> iThisChild;
00419                 <font class="keywordtype">char</font> szWindowTitle[20];
00420                 iThisChild = GetDlgCtrlID(hWnd) - <a class="code" href="Oglmdi_8cpp.html#a1">ID_MDI_FIRSTCHILD</a>;
00421                 ReleaseDC(g_child[iThisChild].hWnd, g_child[iThisChild].hDC);    <font class="comment">// Free this childs DC and RC</font>
00422                 wglDeleteContext(g_child[iThisChild].hRC);
00423                 <font class="keywordflow">if</font>(iThisChild != <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a>)                  <font class="comment">// If this child isn't the last in the array of children</font>
00424                 {
00425                     <font class="keywordflow">for</font> (iLoop = iThisChild; iLoop &lt; (g_iNumChild); iLoop++)   <font class="comment">// Loop from this child to the end of the array</font>
00426                     {
00427                         g_child[iLoop] = g_child[iLoop + 1];       <font class="comment">// Shift the children forward in the array</font>
00428                         sprintf(szWindowTitle, <font class="stringliteral">"%d"</font>, iLoop);
00429                         SetWindowText(g_child[iLoop].hWnd, szWindowTitle);  <font class="comment">// Renumber the children</font>
00430                     }
00431                 }
00432             }
00433         <font class="keywordflow">break</font>;
00434 
00435         <font class="keywordflow">case</font> WM_MDIACTIVATE:
00436         {
00437             HMENU hMenu, hFileMenu;
00438             UINT uEnableFlag;
00439 
00440             hMenu = GetMenu(<a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a>);
00441             <font class="keywordflow">if</font>(hWnd == (HWND)lParam)       <font class="comment">//being activated</font>
00442             {
00443                 uEnableFlag = MF_ENABLED;
00444             }
00445             <font class="keywordflow">else</font>
00446             {
00447                 uEnableFlag = MF_GRAYED;    <font class="comment">//being de-activated</font>
00448             }
00449             EnableMenuItem(hMenu, 1, MF_BYPOSITION | uEnableFlag);
00450             EnableMenuItem(hMenu, 2, MF_BYPOSITION | uEnableFlag);
00451 
00452             hFileMenu = GetSubMenu(hMenu, 0);
00453             EnableMenuItem(hFileMenu, CM_FILE_SAVE, MF_BYCOMMAND | uEnableFlag);
00454             EnableMenuItem(hFileMenu, CM_FILE_SAVEAS, MF_BYCOMMAND | uEnableFlag);
00455 
00456             DrawMenuBar(<a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a>);
00457         }
00458         <font class="keywordflow">break</font>;
00459 
00460         <font class="keywordflow">case</font> WM_COMMAND:
00461             <font class="keywordflow">switch</font>(LOWORD(wParam))
00462             {
00463 <font class="comment">//              case CM_FILE_SAVE: etc</font>
00464             }
00465         <font class="keywordflow">return</font> 0;
00466     }
00467     <font class="keywordflow">return</font> DefMDIChildProc(hWnd, uMessage, wParam, lParam);
00468 }
00469 
<a name="l00470"></a><a class="code" href="Oglmdi_8cpp.html#a24">00470</a> <font class="keywordtype">int</font> WINAPI <a class="code" href="Oglmdi_8cpp.html#a24">WinMain</a>(HINSTANCE hInstance, HINSTANCE, LPSTR, <font class="keywordtype">int</font> nCmdShow)
00471 {
00472     MSG Msg;
00473     WNDCLASSEX wc;
00474     <a class="code" href="Oglmdi_8cpp.html#a4">g_hInst</a> = hInstance;
00475 
00476     <font class="comment">// Create an OpenGL compatible window class</font>
00477     wc.cbSize = <font class="keyword">sizeof</font>(WNDCLASSEX);
00478     wc.style = CS_HREDRAW | CS_VREDRAW | CS_OWNDC | CS_DBLCLKS;
00479     wc.lpfnWndProc = (WNDPROC)<a class="code" href="Oglmdi_8cpp.html#a23">MDIChildWndProc</a>;
00480     wc.cbClsExtra = 0;
00481     wc.cbWndExtra = 0;
00482     wc.hInstance = hInstance;
00483     wc.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_CHILDICON));
00484     wc.hCursor = LoadCursor(NULL, IDC_ARROW);
00485     wc.hbrBackground = (HBRUSH)(COLOR_3DSHADOW+1);    <font class="comment">// Background color (Only seen if OGL fails)</font>
00486     wc.lpszMenuName = NULL;
00487     wc.lpszClassName = <a class="code" href="Oglmdi_8cpp.html#a3">g_szChildClassName</a>;
00488     wc.hIconSm = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_CHILDICON));
00489 
00490     <font class="keywordflow">if</font>(!RegisterClassEx(&amp;wc))
00491     {
00492         MessageBox(NULL,<font class="stringliteral">"Failed to register the child window."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONEXCLAMATION);
00493         <font class="keywordflow">return</font> FALSE;
00494     }
00495 
00496     <font class="comment">// Create the frame window</font>
00497     wc.cbSize = <font class="keyword">sizeof</font>(WNDCLASSEX);
00498     wc.style = CS_HREDRAW | CS_VREDRAW;
00499     wc.lpfnWndProc = (WNDPROC)<a class="code" href="Oglmdi_8cpp.html#a22">WndProc</a>;
00500     wc.cbClsExtra = 0;
00501     wc.cbWndExtra = 0;
00502     wc.hInstance = hInstance;
00503     wc.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_MYICON));
00504     wc.hCursor = LoadCursor(NULL, IDC_ARROW);
00505     wc.hbrBackground = (HBRUSH)(COLOR_3DSHADOW+1);
00506     wc.lpszMenuName = <font class="stringliteral">"MAIN"</font>;
00507     wc.lpszClassName = <a class="code" href="Oglmdi_8cpp.html#a2">g_szMainClassName</a>;
00508     wc.hIconSm = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_MYICON));
00509 
00510     <font class="keywordflow">if</font>(!RegisterClassEx(&amp;wc))
00511     {
00512         MessageBox(0, <font class="stringliteral">"Failed to register the main window."</font>, <font class="stringliteral">"Error"</font>,
00513         MB_ICONEXCLAMATION | MB_OK);
00514         <font class="keywordflow">return</font> -1;
00515     }
00516 
00517     <a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a> = CreateWindowEx(WS_EX_LEFT, <a class="code" href="Oglmdi_8cpp.html#a2">g_szMainClassName</a>, <font class="stringliteral">"Al's OpenGL MDI Example"</font>,
00518     WS_OVERLAPPEDWINDOW | WS_CLIPCHILDREN,
00519     CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,
00520     NULL, NULL, hInstance, NULL);
00521 
00522     <font class="keywordflow">if</font>(<a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a> == NULL)
00523     {
00524         MessageBox(0, <font class="stringliteral">"Failed to create window."</font>, <font class="stringliteral">"ERROR"</font>, MB_ICONEXCLAMATION | MB_OK);
00525         <font class="keywordflow">return</font> -1;
00526     }
00527 
00528     ShowWindow(<a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a>, nCmdShow);
00529     UpdateWindow(<a class="code" href="Oglmdi_8cpp.html#a6">g_hMainWindow</a>);
00530 
00531     <font class="keywordtype">int</font> iLoop;
00532     <font class="keywordflow">while</font>(GetMessage(&amp;Msg, NULL, 0, 0))
00533     {
00534         <font class="keywordflow">if</font>(!TranslateMDISysAccel(<a class="code" href="Oglmdi_8cpp.html#a5">g_hMDIClient</a>, &amp;Msg))
00535         {
00536             TranslateMessage(&amp;Msg);
00537             DispatchMessage(&amp;Msg);
00538         }
00539 
00540         <font class="keywordflow">if</font>(g_iNumChild)                             <font class="comment">// If we have some children</font>
00541         {
00542             <font class="keywordflow">for</font>(iLoop = 0; iLoop &lt; <a class="code" href="Oglmdi_8cpp.html#a17">g_iNumChild</a>; iLoop++)   <font class="comment">// Loop through all children</font>
00543             {
00544                 <font class="keywordflow">if</font>(!IsIconic(g_child[iLoop].hWnd))   <font class="comment">// If child isn't iconic (minimized)</font>
00545                 {
00546                     wglMakeCurrent(g_child[iLoop].hDC, g_child[iLoop].hRC);  <font class="comment">// Make them the current DC and RC</font>
00547                     GetClientRect(g_child[iLoop].hWnd, &amp;<a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>);
00548                     <font class="keywordflow">if</font>(<a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>.right &gt; 0 &amp;&amp; <a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>.bottom &gt; 0)
00549                         <a class="code" href="Oglmdi_8cpp.html#a20">SetProjection</a>(<a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>.right, <a class="code" href="Oglmdi_8cpp.html#a7">g_rectChild</a>.bottom);        <font class="comment">// Set the childs projection matrix</font>
00550                     <a class="code" href="Oglmdi_8cpp.html#a21">DrawGLScene</a>();
00551                     glFlush();
00552                     SwapBuffers(g_child[iLoop].hDC);
00553                 }
00554             }
00555         }
00556     }
00557     <font class="keywordflow">return</font> Msg.wParam;
00558 }
00559 
00560 <font class="comment">/*</font>
00561 <font class="comment"></font>
00562 <font class="comment">In this example I use the same draw routine for each child window. By adding a integer type</font>
00563 <font class="comment">index to the child structure a different draw routine could be used based on the index. This</font>
00564 <font class="comment">could then also be used to choose the type of child class to create and which child window</font>
00565 <font class="comment">process to use.</font>
00566 <font class="comment"></font>
00567 <font class="comment">btw</font>
00568 <font class="comment">The strange comment style you see in the code is a handy way to temporarily comment out blocks of</font>
00569 <font class="comment">code. By removing the first forward slash the code is disabled and to enable just add the first</font>
00570 <font class="comment">slash again. This saves having to run up and down the code adding and removing the first and last</font>
00571 <font class="comment">comment delimiters.</font>
00572 <font class="comment"></font>
00573 <font class="comment">ex.</font>
00574 <font class="comment"></font>
00575 <font class="comment">//*</font>
00576 <font class="comment">working code</font>
00577 <font class="comment">//*/</font>
00578 
00579 <font class="comment">/*</font>
00580 <font class="comment">disabled code</font>
00581 <font class="comment">//*/</font>
00582 
00583                                          
00584 
00585 
</pre></div><hr><address align="right"><small>Generated on Fri Dec 23 05:19:18 2005 for OpenGL MDI by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
