<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>texture.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>texture.cpp</h1><a href="texture_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include &lt;windows.h&gt;</font>
00002 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</font>
00003 <font class="preprocessor">#include "mmgr.h"</font>
00004 
<a name="l00005"></a><a class="code" href="classTEXTURE.html#a0">00005</a> <a class="code" href="classTEXTURE.html#a0">TEXTURE::TEXTURE</a>()
00006 {
00007 }
00008 
<a name="l00009"></a><a class="code" href="classTEXTURE.html#a1">00009</a> <a class="code" href="classTEXTURE.html#a1">TEXTURE::~TEXTURE</a>()
00010 {
00011 }
00012 
<a name="l00013"></a><a class="code" href="classTEXTURE.html#a2">00013</a> <font class="keywordtype">bool</font> <a class="code" href="classTEXTURE.html#a2">TEXTURE::LoadTGA</a>()
00014 {
00015     GLubyte TGAheader[12]={0,0,2,0,0,0,0,0,0,0,0,0};                        <font class="comment">// Uncompressed TGA Header</font>
00016     GLubyte TGAcompare[12];                                                 <font class="comment">// Used To Compare TGA Header</font>
00017     GLubyte header[6];                                                      <font class="comment">// First 6 Useful Bytes From The Header</font>
00018     GLuint  bytesPerPixel;                                                  <font class="comment">// Holds Number Of Bytes Per Pixel Used In The TGA File</font>
00019     GLuint  imageSize;                                                      <font class="comment">// Used To Store The Image Size When Setting Aside Ram</font>
00020     GLuint  temp;                                                           <font class="comment">// Temporary Variable</font>
00021     GLuint  type=GL_RGBA;                                                   <font class="comment">// Set The Default GL Mode To RBGA (32 BPP)</font>
00022     FILE *file = fopen(<a class="code" href="classTEXTURE.html#m0">TexName</a>, <font class="stringliteral">"rb"</font>);                                      <font class="comment">// Open The TGA Fi</font>
00023     <font class="keywordflow">if</font>( file==NULL ||                                                       <font class="comment">// Does File Even Exist?</font>
00024     fread(TGAcompare,1,<font class="keyword">sizeof</font>(TGAcompare),file)!=<font class="keyword">sizeof</font>(TGAcompare) ||      <font class="comment">// Are There 12 Bytes To Read?</font>
00025     memcmp(TGAheader,TGAcompare,<font class="keyword">sizeof</font>(TGAheader))!=0               ||      <font class="comment">// Does The Header Match What We Want?</font>
00026     fread(header,1,<font class="keyword">sizeof</font>(header),file)!=<font class="keyword">sizeof</font>(header))                    <font class="comment">// If So Read Next 6 Header Bytes</font>
00027     {
00028         <font class="keywordflow">if</font> (file == NULL)                                                   <font class="comment">// Did The File Even Exist? *Added Jim Strong*</font>
00029         {
00030             MessageBox(NULL,<font class="stringliteral">"Image file was not found"</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00031             <font class="keywordflow">return</font> <font class="keyword">false</font>;                                                   <font class="comment">// Return False</font>
00032         }
00033             <font class="keywordflow">if</font>(TGAcompare[2] == 1)
00034                 MessageBox(NULL,<font class="stringliteral">"Image cannot be indexed color. \r\n Convert the image to RGB or RGBA."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00035             <font class="keywordflow">if</font>(TGAcompare[2] == 3)
00036                 MessageBox(NULL,<font class="stringliteral">"Image cannot be greyscale color. \r\n Convert the image to RGB or RGBA."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00037             <font class="keywordflow">if</font>(TGAcompare[2] == 9 || TGAcompare[2] == 10)
00038                 MessageBox(NULL,<font class="stringliteral">"Image cannot be compressed. \r\n Convert the image to an uncompressed format."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00039             fclose(file);                                                   <font class="comment">// If Anything Failed, Close The File</font>
00040             <font class="keywordflow">return</font> <font class="keyword">false</font>;                                                   <font class="comment">// Return False</font>
00041         }
00042         <a class="code" href="classTEXTURE.html#m3">Width</a>  = header[1] * 256 + header[0];                      <font class="comment">// Determine The TGA Width      (highbyte*256+lowbyte)</font>
00043         <a class="code" href="classTEXTURE.html#m4">Height</a> = header[3] * 256 + header[2];                      <font class="comment">// Determine The TGA Height     (highbyte*256+lowbyte)</font>
00044         <font class="keywordflow">if</font>( <a class="code" href="classTEXTURE.html#m3">Width</a>  &lt;=0     ||                                      <font class="comment">// Is The Width Less Than Or Equal To Zero</font>
00045         <a class="code" href="classTEXTURE.html#m4">Height</a> &lt;=0     ||                                          <font class="comment">// Is The Height Less Than Or Equal To Zero</font>
00046         (header[4]!=24 &amp;&amp; header[4]!=32))                                   <font class="comment">// Is The TGA 24 or 32 Bit?</font>
00047         {
00048             fclose(file);                                                   <font class="comment">// If Anything Failed, Close The File</font>
00049             <font class="keywordflow">if</font>(<a class="code" href="classTEXTURE.html#m3">Width</a>  &lt;=0 || <a class="code" href="classTEXTURE.html#m4">Height</a>  &lt;=0)
00050                 MessageBox(NULL,<font class="stringliteral">"Image must have a width and height greater than 0"</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00051             <font class="keywordflow">if</font>(header[4]!=24 &amp;&amp; header[4]!=32)
00052                 MessageBox(NULL,<font class="stringliteral">"Image must be 24 or 32 bit"</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00053             <font class="keywordflow">return</font> <font class="keyword">false</font>;                                               <font class="comment">// Return False</font>
00054         }
00055         <a class="code" href="classTEXTURE.html#m2">Bpp</a>    = header[4];                                        <font class="comment">// Grab The TGA's Bits Per Pixel (24 or 32)</font>
00056         bytesPerPixel   = <a class="code" href="classTEXTURE.html#m2">Bpp</a>/8;                                   <font class="comment">// Divide By 8 To Get The Bytes Per Pixel</font>
00057         imageSize       = <a class="code" href="classTEXTURE.html#m3">Width</a>*<a class="code" href="classTEXTURE.html#m4">Height</a>*bytesPerPixel;     <font class="comment">// Calculate The Memory Required For The TGA Data</font>
00058         <a class="code" href="classTEXTURE.html#m1">ImageData</a> = (GLubyte*)malloc(imageSize);                    <font class="comment">// Reserve Memory To Hold The TGA Data</font>
00059         <font class="keywordflow">if</font>( <a class="code" href="classTEXTURE.html#m1">ImageData</a> == NULL ||                                     <font class="comment">// Does The Storage Memory Exist?</font>
00060         fread(<a class="code" href="classTEXTURE.html#m1">ImageData</a>, 1, imageSize, file)!=imageSize)           <font class="comment">// Does The Image Size Match The Memory Reserved?</font>
00061         {
00062             <font class="keywordflow">if</font>(<a class="code" href="classTEXTURE.html#m1">ImageData</a>!=NULL)                                    <font class="comment">// Was Image Data Loaded</font>
00063                 free(<a class="code" href="classTEXTURE.html#m1">ImageData</a>);                                   <font class="comment">// If So, Release The Image Data</font>
00064             MessageBox(NULL,<font class="stringliteral">"Image load failed for unknown reason."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00065             fclose(file);                                                   <font class="comment">// Close The File</font>
00066             <font class="keywordflow">return</font> <font class="keyword">false</font>;                                                   <font class="comment">// Return False</font>
00067         }
00068         <font class="keywordflow">for</font>(GLuint i=0; i&lt;(GLuint)imageSize; i+=bytesPerPixel)                 <font class="comment">// Loop Through The Image Data</font>
00069         {                                                                   <font class="comment">// Swaps The 1st And 3rd Bytes ('R'ed and 'B'lue)</font>
00070             temp = <a class="code" href="classTEXTURE.html#m1">ImageData</a>[i];                                     <font class="comment">// Temporarily Store The Value At Image Data 'i'</font>
00071             <a class="code" href="classTEXTURE.html#m1">ImageData</a>[i] = <a class="code" href="classTEXTURE.html#m1">ImageData</a>[i + 2];                       <font class="comment">// Set The 1st Byte To The Value Of The 3rd Byte</font>
00072             <a class="code" href="classTEXTURE.html#m1">ImageData</a>[i + 2] = (GLubyte)temp;                               <font class="comment">// Set The 3rd Byte To The Value In 'temp' (1st Byte Value)</font>
00073         }
00074         fclose (file);                                                      <font class="comment">// Close The File</font>
00075 
00076         <font class="comment">// Build A Texture From The Data</font>
00077         glGenTextures(1, &amp;<a class="code" href="classTEXTURE.html#m5">TexID</a>);                                <font class="comment">// Generate OpenGL texture IDs</font>
00078         glBindTexture(GL_TEXTURE_2D, <a class="code" href="classTEXTURE.html#m5">TexID</a>);
00079         glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP);
00080         glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP);
00081         glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
00082         glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
00083         <font class="keywordflow">if</font> (<a class="code" href="classTEXTURE.html#m2">Bpp</a>==24)                                             <font class="comment">// Was The TGA 24 Bits</font>
00084         {
00085             type=GL_RGB;                                                    <font class="comment">// If So Set The 'type' To GL_RGB</font>
00086         }
00087         glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
00088         glTexImage2D(GL_TEXTURE_2D, 0, type, <a class="code" href="classTEXTURE.html#m3">Width</a>, <a class="code" href="classTEXTURE.html#m4">Height</a>, 0, type, GL_UNSIGNED_BYTE, <a class="code" href="classTEXTURE.html#m1">ImageData</a>);
00089         gluBuild2DMipmaps(GL_TEXTURE_2D, type, <a class="code" href="classTEXTURE.html#m3">Width</a>, <a class="code" href="classTEXTURE.html#m4">Height</a>, type, GL_UNSIGNED_BYTE, <a class="code" href="classTEXTURE.html#m1">ImageData</a>);
00090         free(<a class="code" href="classTEXTURE.html#m1">ImageData</a>);
00091         <font class="keywordflow">return</font> <font class="keyword">true</font>;                                                        <font class="comment">// Texture Building Went Ok, Return True</font>
00092 }
</pre></div><hr><address align="right"><small>Generated on Fri Dec 23 05:19:34 2005 for OpenGL MDI 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
